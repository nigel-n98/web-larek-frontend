# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```

---

## Архитектура проекта

---

### Паттерн проектирования

Архитектура проекта основана на паттерне **MVC (Model-View-Controller)**.

- **Model (Модель)** — `AppState`, `WebLarekAPI`, отвечают за данные и их обработку.
- **View (Представление)** — компоненты интерфейса: `Card`, `Form`, `Modal`, `Basket`, `Page`, `Success`.
- **Controller** реализован через механизмы подписки в `EventEmitter`, связывающий модель и представление.

---

### Слои архитектуры
#### Model (Модель)
- `AppState`: хранение состояния корзины и заказа, уведомление об изменениях.
- `WebLarekAPI`: взаимодействие с сервером (загрузка товаров, отправка заказа).

#### View (Представление)
- `Card`: отображение товара.
- `Modal`: всплывающее окно.
- `Form`, `Order`: форма заказа, ввод данных.
- `Basket`: интерфейс корзины.
- `Page`: переключение между представлениями.
- `Success`: экран успешного заказа.

#### EventEmitter (Контроллер)
- Связывает модель и представление через событийную систему.

---

#### `AppState`
Хранит текущее состояние приложения.

**Поля:**
- `catalog: IProduct[]` — список товаров из API.
- `basket: IProduct[]` — текущие товары в корзине.
- `order: IOrder | null` — информация о заказе.

**Методы:**
- `addToBasket(product: IProduct)` — добавляет товар в корзину.
- `removeFromBasket(productId: string)` — удаляет товар.
- `setOrder(data: IOrder)` — сохраняет заказ.
- `clear()` — сбрасывает состояние после оформления.

Компоненты подписываются на события:  
- `'basketUpdated'` — обновление корзины  
- `'orderUpdated'` — изменения в заказе

---

### Связь между слоями

1. Пользователь взаимодействует с компонентами представления (`Card`, `Form`, `Basket`).
2. Эти компоненты генерируют события через `EventEmitter`.
3. `AppState` (модель) реагирует на события и обновляет данные (добавляет товар, сохраняет заказ и т.д.).
4. После изменений `AppState` вызывает события (`emit`), на которые подписаны компоненты представления.
5. Представление обновляется в зависимости от изменённых данных.

Таким образом, модель и представление связаны через централизованный событийный слой — `EventEmitter`, без прямой зависимости.

---

### Базовые классы

#### `EventEmitter`
Класс обеспечивает событийную модель.  
Функции:
- подписка и отписка от событий (`on`, `off`);
- вызов слушателей при возникновении событий (`emit`);
- генерация колбэков-триггеров (`trigger`);
- возможность слушать все события (`onAll`);
  
Применяется для связи между различными частями приложения без жёсткой зависимости.

#### `AppState`
Служит хранилищем состояния приложения.  
Функции:
- хранит текущие товары в корзине;
- сохраняет информацию о заказе;
- уведомляет подписчиков при обновлении (`emit('basketUpdated')`, `emit('orderUpdated')`).

---

### Компоненты

#### `Card`
Компонент для отображения карточки товара. Используется на главной странице и в корзине.

#### `Modal`
Компонент модального окна. Используется для отображения форм, успешного заказа и т.п.

#### `Form`
Компонент формы заказа. Отвечает за сбор данных пользователя.

#### `Page`
Управляет отображением разных состояний страницы (каталог, корзина, оформление заказа, успешный заказ).

#### `Basket`
Компонент отображения списка выбранных товаров и их итоговой стоимости. Позволяет удалять товары.

#### `Order`
Компонент для ввода контактных и платёжных данных. Работает с формой и отправкой данных на сервер.

#### `Success`
Компонент для отображения финального экрана после успешного оформления заказа.

#### `WebLarekAPI`
Класс для общения с сервером по HTTP. Отвечает за загрузку списка товаров и отправку заказов.

---

### Взаимодействие компонентов

- Все компоненты не общаются напрямую, а взаимодействуют через **EventEmitter**.
- `AppState` уведомляет подписчиков об изменениях состояния.
- `Page` управляет тем, какие компоненты видны в текущий момент.
- Данные поступают от API (`LarekAPI`), сохраняются в `AppState`, после чего отображаются на странице через `Card`.

---

### Типы данных

- **IProduct**: тип описывает товар (id, title, price и т.д.).
- **IOrder**: контактные и платёжные данные пользователя.
- **TOrderInfo**: данные формы заказа.
- **FormErrors**: ошибки формы.
- **TBasket**:  статусы корзины.
- **TCategory**: категории товара.
- **TPayment**: способы оплаты